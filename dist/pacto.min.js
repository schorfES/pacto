var pacto=function(t){"use strict";const e=new WeakMap;class r{constructor(){e.set(this,{})}on(t,r){const n=e.get(this);return n[t]=n[t]||[],n[t].push(r),this}off(t,r){const n=e.get(this);return n[t]?(n[t]=r?n[t].filter((t=>t!==r)):[],this):this}trigger(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=e.get(this);return n[t]&&n[t].forEach((e=>e.call(null,{sender:this,type:t,data:r}))),this}}const n=new WeakMap;class o{constructor(t){const e={context:t,register:{}};n.set(this,e)}add(t,e){const{register:r}=n.get(this);return r[t]=e,this}remove(t){const{register:e}=n.get(this);return e[t]=void 0,delete e[t],this}get(t){const{register:e}=n.get(this);return e[t]}has(t){return!!this.get(t)}}class s extends o{constructor(t){super(t);const e=n.get(this),{register:r}=e;e.onAction=e=>{const{type:n}=e,o=r[n];o&&[].concat(o).forEach((r=>{var n=new r;n.context=t,n.event=e,n.run()}))}}add(t,e){const r=n.get(this),{context:o,onAction:s}=r,i=this.get(t);return i||o.on(t,s),e=(i||[]).concat(e),super.add(t,e)}remove(t,e){const r=this.get(t);if(r&&r.length){if(!e)return super.remove(t);if(e instanceof Array||(e=[e]),e.forEach((t=>{let e=r.indexOf(t);for(;e>-1;)r.splice(e,1),e=r.indexOf(t)})),0===r.length)return super.remove(t)}return this}}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function c(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function h(t){return"boolean"==typeof t&&!t}function l(t,e){window.console&&window.console.error&&window.console.error("[InitializeLazy] "+e.message),t.context.trigger(t.event.type+":error",{error:e})}return t.Context=class extends r{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super();const e={actions:new s(this),values:new o(this),options:t};t&&t.history&&(e.history=[]),n.set(this,e)}get actions(){return n.get(this).actions}get values(){return n.get(this).values}get history(){return n.get(this).history||null}trigger(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const{history:r}=this;return r&&r.push({type:t,data:e}),super.trigger(t,e)}flushHistory(){const{history:t}=this;t&&t.splice(0,t.length)}},t.EventEmitter=r,t.Initialize=class{get settings(){return null}run(){const t=function(t){const e=t.settings;if(!e||"object"!=typeof e)throw new Error("Define settings object");if(!e.view)throw new Error("Define a view");if(!e.selector)throw new Error("Define a selector");if(!e.namespace)throw new Error("Define a namespace");return e}(this),{context:e,event:r}=this,{data:n}=r,o=e.values.get(t.namespace)||[],s=n&&n.root?n.root:document.body;let l,u;l=this.beforeAll(),h(l)||(u=s.querySelectorAll(t.selector),0!==u.length&&(u.forEach(((r,n)=>{if(o.some((t=>t.el==r)))return;const s=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach((function(e){c(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({el:r,context:e},t.params);let u=null;l=this.beforeEach(s,r,n),h(l)||(u=new t.view(s),u.render(),l=this.afterEach(u,r,n),h(l)||o.push(u))})),o.length>0&&e.values.add(t.namespace,o),this.afterAll(o)))}beforeAll(){}beforeEach(){}afterEach(){}afterAll(){}},t.InitializeLazy=class{constructor(){this._onIntersect=this._onIntersect.bind(this)}get settings(){return null}get import(){return null}get condition(){return"complete"===document.readyState?Promise.resolve():new Promise((t=>window.addEventListener("DOMContentLoaded",t,{once:!0})))}get observerSettings(){return{rootMargin:"0px",threshold:[0,.5,1]}}run(){const{selector:t}=function(t){const e=t.settings;if(!e||"object"!=typeof e)throw new Error("Define settings object");if(!e.selector)throw new Error("Define a selector");return e}(this),{condition:e}=this;if(!(e instanceof Promise))throw new Error("A conditon must be an instance of promise.");e.then((()=>this._lookup(t))).catch((t=>l(this,t)))}_lookup(t){const{event:e}=this,{data:r}=e,n=(r&&r.root?r.root:document.body).querySelectorAll(t);0!==n.length&&this._setup(n)}_setup(t){window.IntersectionObserver?this._observe(t):this._fetch()}_observe(t){this._observer=new window.IntersectionObserver(this._onIntersect,this.observerSettings),t.forEach((t=>this._observer.observe(t)))}_disconnect(){this._observer.disconnect(),this._observer=null}_fetch(){const{event:t}=this;this.import.then((e=>{const r=e.Action||e.default;if(!r)throw new Error("Module must export Action or default");if("function"!=typeof r.prototype.run)throw new Error("Module must be an Action");this.context.actions.add(t.type,r).remove(t.type,this.constructor),this._execute(r)})).catch((t=>l(this,t)))}_execute(t){const e=new t;e.context=this.context,e.event=this.event,e.run()}_onIntersect(t){t.some((t=>t.isIntersecting))&&(this._disconnect(),this._fetch())}},t.View=class extends r{constructor(t){super(),this.options=t,this.context=t.context,this.el=t.el}render(){return this}destroy(){return this.options=null,this.context=null,this.el=null,this}},Object.defineProperty(t,"__esModule",{value:!0}),t}({});
