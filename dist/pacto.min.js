var pacto=function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?l(t):e}function v(t){return function(){var e,n=s(t);if(a()){var r=s(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return h(this,e)}}function y(t,e,n){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}var p=new WeakMap,g=function(){function t(){n(this,t),p.set(this,{})}return o(t,[{key:"on",value:function(t,e){var n=p.get(this);return n[t]=n[t]||[],n[t].push(e),this}},{key:"off",value:function(t,e){var n=p.get(this);return n[t]?(n[t]=e?n[t].filter((function(t){return t!==e})):[],this):this}},{key:"trigger",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=p.get(this);return r[t]&&r[t].forEach((function(r){return r.call(null,{sender:e,type:t,data:n})})),this}}]),t}(),b=new WeakMap,d=function(){function t(e){n(this,t);var r={context:e,register:{}};b.set(this,r)}return o(t,[{key:"add",value:function(t,e){return b.get(this).register[t]=e,this}},{key:"remove",value:function(t){var e=b.get(this).register;return e[t]=void 0,delete e[t],this}},{key:"get",value:function(t){return b.get(this).register[t]}},{key:"has",value:function(t){return!!this.get(t)}}]),t}(),w=function(t){c(r,t);var e=v(r);function r(t){var o;n(this,r),o=e.call(this,t);var i=b.get(l(o)),u=i.register;return i.onAction=function(e){var n=e.type,r=u[n];r&&[].concat(r).forEach((function(n){var r=new n;r.context=t,r.event=e,r.run()}))},o}return o(r,[{key:"add",value:function(t,e){var n=b.get(this),o=n.context,i=n.onAction,u=this.get(t);return u||o.on(t,i),e=(u||[]).concat(e),y(s(r.prototype),"add",this).call(this,t,e)}},{key:"remove",value:function(t,e){var n=this.get(t);if(n&&n.length){if(!e)return y(s(r.prototype),"remove",this).call(this,t);if(e instanceof Array||(e=[e]),e.forEach((function(t){for(var e=n.indexOf(t);e>-1;)n.splice(e,1),e=n.indexOf(t)})),0===n.length)return y(s(r.prototype),"remove",this).call(this,t)}return this}}]),r}(d),k=function(t){c(r,t);var e=v(r);function r(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;n(this,r),t=e.call(this);var i={actions:new w(l(t)),values:new d(l(t)),options:o};return o&&o.history&&(i.history=[]),b.set(l(t),i),t}return o(r,[{key:"trigger",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.history;return n&&n.push({type:t,data:e}),y(s(r.prototype),"trigger",this).call(this,t,e)}},{key:"flushHistory",value:function(){var t=this.history;t&&t.splice(0,t.length)}},{key:"actions",get:function(){return b.get(this).actions}},{key:"values",get:function(){return b.get(this).values}},{key:"history",get:function(){return b.get(this).history||null}}]),r}(g);function m(t){return"boolean"==typeof t&&!t}var O=function(){function t(){n(this,t)}return o(t,[{key:"run",value:function(){var t,n=this,r=function(t){var n=t.settings;if(!n||"object"!==e(n))throw new Error("Define settings object");if(!n.view)throw new Error("Define a view");if(!n.selector)throw new Error("Define a selector");if(!n.namespace)throw new Error("Define a namespace");return n}(this),o=this.context,c=this.event.data,s=o.values.get(r.namespace)||[],f=c&&c.root?c.root:document.body;m(this.beforeAll())||0!==(t=f.querySelectorAll(r.selector)).length&&(t.forEach((function(t,e){if(!s.some((function(e){return e.el==t}))){var c=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){i(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({el:t,context:o},r.params),f=null;m(n.beforeEach(c,t,e))||((f=new r.view(c)).render(),m(n.afterEach(f,t,e))||s.push(f))}})),s.length>0&&o.values.add(r.namespace,s),this.afterAll(s))}},{key:"beforeAll",value:function(){}},{key:"beforeEach",value:function(){}},{key:"afterEach",value:function(){}},{key:"afterAll",value:function(){}},{key:"settings",get:function(){return null}}]),t}();var _=function(){function t(){n(this,t),this._onIntersect=this._onIntersect.bind(this)}return o(t,[{key:"run",value:function(){var t=function(t){var n=t.settings;if(!n||"object"!==e(n))throw new Error("Define settings object");if(!n.selector)throw new Error("Define a selector");return n}(this);this._lookup(t.selector)}},{key:"_lookup",value:function(t){var e=this,n=this.event.data,r=(n&&n.root?n.root:document.body).querySelectorAll(t);0!==r.length&&("complete"===document.readyState?this._setup(r):window.addEventListener("load",(function(){return e._setup(r)}),{once:!0}))}},{key:"_setup",value:function(t){window.IntersectionObserver?this._observe(t):this._fetch()}},{key:"_observe",value:function(t){var e=this;this._observer=new window.IntersectionObserver(this._onIntersect,this.observerSettings),t.forEach((function(t){return e._observer.observe(t)}))}},{key:"_disconnect",value:function(){this._observer.disconnect(),this._observer=null}},{key:"_fetch",value:function(){var t=this,e=this.event;this.import.then((function(n){var r=n.Action||n.default;if(!r)throw new Error("Module must export Action or default");if("function"!=typeof r.prototype.run)throw new Error("Module must be an Action");t.context.actions.add(e.type,r).remove(e.type,t.constructor),t._execute(r)})).catch((function(e){throw t.context.trigger(t.event.type+":error",{error:e}),e}))}},{key:"_execute",value:function(t){var e=new t;e.context=this.context,e.event=this.event,e.run()}},{key:"_onIntersect",value:function(t){t.some((function(t){return t.isIntersecting}))&&(this._disconnect(),this._fetch())}},{key:"settings",get:function(){return null}},{key:"import",get:function(){return null}},{key:"observerSettings",get:function(){return{rootMargin:"0px",threshold:[0,.5,1]}}}]),t}(),j=function(t){c(r,t);var e=v(r);function r(t){var o;return n(this,r),(o=e.call(this)).options=t,o.context=t.context,o.el=t.el,o}return o(r,[{key:"render",value:function(){return this}},{key:"destroy",value:function(){return this.options=null,this.context=null,this.el=null,this}}]),r}(g);return t.Context=k,t.EventEmitter=g,t.Initialize=O,t.InitializeLazy=_,t.View=j,t}({});
