"use strict";var _get=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(r):void 0},_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},_createClass=function(){function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.pacto={})}(void 0,function(t){var o=new WeakMap,i=function(){function t(){_classCallCheck(this,t),o.set(this,{})}return _createClass(t,[{key:"on",value:function(t,e){var n=o.get(this);return n[t]=n[t]||[],n[t].push(e),this}},{key:"off",value:function(t,e){var n=o.get(this);return n[t]&&(n[t]=e?n[t].filter(function(t){return t!==e}):[]),this}},{key:"trigger",value:function(e){var n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,t=o.get(this);return t[e]&&t[e].forEach(function(t){return t.call(null,{sender:n,type:e,data:r})}),this}}]),t}(),r=new WeakMap,s=function(t){function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,n);var o=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));t=_extends({},o.defaults,t);var e=new Proxy(t,{set:function(t,e,n){var r=t[e]!==n;return t[e]=n,r&&o.trigger("change",{prop:e,value:n}),!0}});return r.set(o,e),o}return _inherits(n,i),_createClass(n,[{key:"defaults",get:function(){return null}},{key:"props",get:function(){return r.get(this)}}]),n}(),u=new WeakMap,e=function(t){function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];_classCallCheck(this,r);var a=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this)),c=function(t){return t instanceof s?t:new a.Model(t)},e={get:function(i,s){var u=i[s];return"function"==typeof u?function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r,o=!1;switch(s){case"pop":case"reverse":case"shift":case"sort":o=!0;break;case"fill":o=!0,e[0]=c(e[0]);break;case"push":case"unshift":o=!0,e=e.map(c);break;case"splice":o=!0,e=e.map(function(t,e){return 1<e?c(t):t})}return r=u.apply(i,e),o&&a.trigger("change",{method:s}),r}:u}},n=new Proxy(t.map(c),e);return u.set(a,n),a}return _inherits(r,i),_createClass(r,[{key:"Model",get:function(){return s}},{key:"models",get:function(){return u.get(this)}}]),r}(),a=new WeakMap,n=function(){function n(t){_classCallCheck(this,n);var e={context:t,register:{}};a.set(this,e)}return _createClass(n,[{key:"add",value:function(t,e){return a.get(this).register[t]=e,this}},{key:"remove",value:function(t){var e=a.get(this).register;return e[t]=void 0,delete e[t],this}},{key:"get",value:function(t){return a.get(this).register[t]}},{key:"has",value:function(t){return!!this.get(t)}}]),n}(),c=function(t){function s(r){_classCallCheck(this,s);var t=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,r)),e=a.get(t),o=e.register;return e.onAction=function(n){var t=n.type,e=o[t];e&&e.forEach(function(t){var e=new t;e.context=r,e.event=n,e.run()})},t}return _inherits(s,n),_createClass(s,[{key:"add",value:function(t,e){var n=a.get(this),r=n.context,o=n.onAction,i=this.get(t);return i||r.on(t,o),e=(i||[]).concat(e),_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"add",this).call(this,t,e)}},{key:"remove",value:function(t,e){var n=this.get(t);if(n&&n.length){if(!e)return _get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"remove",this).call(this,t);if(e instanceof Array||(e=[e]),e.forEach(function(t){for(var e=n.indexOf(t);-1<e;)n.splice(e,1),e=n.indexOf(t)}),0===n.length)return _get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"remove",this).call(this,t)}return this}}]),s}(),l=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a.set(t,{actions:new c(t),values:new n(t)}),t}return _inherits(e,i),_createClass(e,[{key:"actions",get:function(){return a.get(this).actions}},{key:"values",get:function(){return a.get(this).values}}]),e}();t.Collection=e,t.Context=l,t.EventEmitter=i,t.Model=s,Object.defineProperty(t,"__esModule",{value:!0})});