var pacto=function(t){"use strict";const e=new WeakMap;class r{constructor(){e.set(this,{})}on(t,r){const n=e.get(this);return n[t]=n[t]||[],n[t].push(r),this}off(t,r){const n=e.get(this);return n[t]?(n[t]=r?n[t].filter((t=>t!==r)):[],this):this}trigger(t,r=null){const n=e.get(this);return n[t]&&n[t].forEach((e=>e.call(null,{sender:this,type:t,data:r}))),this}}const n=new WeakMap;class s{constructor(t){const e={context:t,register:{}};n.set(this,e)}add(t,e){const{register:r}=n.get(this);return r[t]=e,this}remove(t){const{register:e}=n.get(this);return e[t]=void 0,delete e[t],this}get(t){const{register:e}=n.get(this);return e[t]}has(t){return!!this.get(t)}}class o extends s{constructor(t){super(t);const e=n.get(this),{register:r}=e;e.onAction=e=>{const{type:n}=e,s=r[n];s&&[].concat(s).forEach((r=>{var n=new r;n.context=t,n.event=e,n.run()}))}}add(t,e){const r=n.get(this),{context:s,onAction:o}=r,i=this.get(t);return i||s.on(t,o),e=(i||[]).concat(e),super.add(t,e)}remove(t,e){const r=this.get(t);if(r&&r.length){if(!e)return super.remove(t);if(e instanceof Array||(e=[e]),e.forEach((t=>{let e=r.indexOf(t);for(;e>-1;)r.splice(e,1),e=r.indexOf(t)})),0===r.length)return super.remove(t)}return this}}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function c(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function h(t){return"boolean"==typeof t&&!t}return t.Context=class extends r{constructor(t=null){super();const e={actions:new o(this),values:new s(this),options:t};t&&t.history&&(e.history=[]),n.set(this,e)}get actions(){return n.get(this).actions}get values(){return n.get(this).values}get history(){return n.get(this).history||null}trigger(t,e=null){const{history:r}=this;return r&&r.push({type:t,data:e}),super.trigger(t,e)}flushHistory(){const{history:t}=this;t&&t.splice(0,t.length)}},t.EventEmitter=r,t.Initialize=class{get settings(){return null}run(){const t=function(t){const e=t.settings;if(!e||"object"!=typeof e)throw new Error("Define settings object");if(!e.view)throw new Error("Define a view");if(!e.selector)throw new Error("Define a selector");if(!e.namespace)throw new Error("Define a namespace");return e}(this),{context:e,event:r}=this,{data:n}=r,s=e.values.get(t.namespace)||[],o=n&&n.root?n.root:document.body;let u,l;u=this.beforeAll(),h(u)||(l=o.querySelectorAll(t.selector),0!==l.length&&(l.forEach(((r,n)=>{if(s.some((t=>t.el==r)))return;const o=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach((function(e){c(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({el:r,context:e},t.params);let l=null;u=this.beforeEach(o,r,n),h(u)||(l=new t.view(o),l.render(),u=this.afterEach(l,r,n),h(u)||s.push(l))})),s.length>0&&e.values.add(t.namespace,s),this.afterAll(s)))}beforeAll(){}beforeEach(){}afterEach(){}afterAll(){}},t.InitializeLazy=class{constructor(){this._onIntersect=this._onIntersect.bind(this)}get settings(){return null}get import(){return null}get observerSettings(){return{rootMargin:"0px",threshold:[0,.5,1]}}run(){const t=function(t){const e=t.settings;if(!e||"object"!=typeof e)throw new Error("Define settings object");if(!e.selector)throw new Error("Define a selector");return e}(this);this._lookup(t.selector)}_lookup(t){const{event:e}=this,{data:r}=e,n=(r&&r.root?r.root:document.body).querySelectorAll(t);0!==n.length&&("complete"===document.readyState?this._setup(n):window.addEventListener("load",(()=>this._setup(n)),{once:!0}))}_setup(t){window.IntersectionObserver?this._observe(t):this._fetch()}_observe(t){this._observer=new window.IntersectionObserver(this._onIntersect,this.observerSettings),t.forEach((t=>this._observer.observe(t)))}_disconnect(){this._observer.disconnect(),this._observer=null}_fetch(){const{event:t}=this;this.import.then((e=>{const r=e.Action||e.default;if(!r)throw new Error("Module must export Action or default");if("function"!=typeof r.prototype.run)throw new Error("Module must be an Action");this.context.actions.add(t.type,r).remove(t.type,this.constructor),this._execute(r)})).catch((t=>{throw this.context.trigger(this.event.type+":error",{error:t}),t}))}_execute(t){const e=new t;e.context=this.context,e.event=this.event,e.run()}_onIntersect(t){t.some((t=>t.isIntersecting))&&(this._disconnect(),this._fetch())}},t.View=class extends r{constructor(t){super(),this.options=t,this.context=t.context,this.el=t.el}render(){return this}destroy(){return this.options=null,this.context=null,this.el=null,this}},Object.defineProperty(t,"__esModule",{value:!0}),t}({});
